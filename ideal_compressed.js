var margin={top:10,right:10,bottom:10,left:10},graphwidth=960-margin.left-margin.right,graphheight=640-margin.top-margin.bottom,svg=d3.select('.graph').append('svg').attr('width',graphwidth+margin.left+margin.right).attr('height',graphheight+margin.top+margin.bottom).append('g').attr('transform','translate('+margin.left+','+margin.top+')');let colorscale=d3.scaleSequential(d3.interpolateRainbow),canvas=document.getElementById('canvas'),canvas2=document.getElementById('canvas2'),width=400,height=600;canvas.width=width,canvas.height=height;let context=canvas.getContext('2d');canvas2.width=width,canvas2.height=height;let context2=canvas2.getContext('2d'),radius=5;function Vector(a,b){this.x=a,this.y=b}Vector.prototype.dotProduct=function(a){return this.x*a.x+this.y*a.y},Vector.prototype.magnitude=function(){return Math.pow(this.x,2)+Math.pow(this.y,2)},Vector.prototype.scale=function(a){this.x*=a,this.y*=a},Vector.prototype.add=function(a){this.x+=a.x,this.y+=a.y},Vector.prototype.subtract=function(a){this.x-=a.x,this.y-=a.y};function Ball(a,b){this.x=a,this.y=b,this.x_speed=3*Math.random()*randNeg(),this.y_speed=3*Math.random()*randNeg(),this.radius=radius}Ball.prototype.draw=function(){context.beginPath(),context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),context.fillStyle='#0000FF',context.fill()},Ball.prototype.update=function(a){this.x+=this.x_speed,this.y+=this.y_speed;let b=this.x-this.radius,c=this.y-this.radius,d=this.x+this.radius,e=this.y+this.radius;if(0>b)this.x=this.radius,this.x_speed=-this.x_speed;else if(d>app.width)this.x=app.width-this.radius,this.x_speed=-this.x_speed;else if(0>c)this.y=this.radius,this.y_speed=-this.y_speed;else if(e>app.height){let f=Math.atan(Math.abs(this.y_speed/this.x_speed)),g=totalVelocity(this.x_speed,this.y_speed);'cold'==a?(g-=0.5,this.y=app.height-this.radius,this.y_speed=-g*Math.sin(f)):'hot'==a?(g+=0.5,this.y=app.height-this.radius,this.y_speed=-g*Math.sin(f)):(this.y=app.height-this.radius,this.y_speed=-this.y_speed),0!=this.x_speed&&(this.x_speed=Math.sign(this.x_speed)*g*Math.cos(f))}},Ball.prototype.bounce=function(a,b){for(b;b<app.particles.length-1;b++)if(Math.pow(a.x-app.particles[b+1].x,2)+Math.pow(a.y-app.particles[b+1].y,2)<Math.pow(2*radius,2)+0.1){let c=new Vector(app.particles[b+1].x_speed,app.particles[b+1].y_speed),d=new Vector(a.x_speed,a.y_speed),e=new Vector(a.x-app.particles[b+1].x,a.y-app.particles[b+1].y),f=new Vector(app.particles[b+1].x_speed,app.particles[b+1].y_speed);f.subtract(d);let g=f.dotProduct(e);g/=e.magnitude(),e.scale(g),d.add(e),c.subtract(e),a.x_speed=d.x,a.y_speed=d.y,app.particles[b+1].x_speed=c.x,app.particles[b+1].y_speed=c.y}};let app=new Vue({el:'#app',data:{particlenum:50,particles:[],width:400,height:600,track_particle:!1,fps:60,heating:'none',lock:!1},computed:{plate:function(){return'cold'==this.heating?{borderBottomColor:'#00CCFF',borderBottomWidth:'4px'}:'hot'==this.heating?{borderBottomColor:'#F00',borderBottomWidth:'4px'}:{borderBottomWidth:'1px'}},dimension:function(){return{width:this.width,height:this.height}}},methods:{adjustParticles:function(){if(context.clearRect(0,0,this.width,this.height),this.particlenum<this.particles.length)this.particles.splice(0,this.particles.length-this.particlenum);else if(this.particlenum>this.particles.length)for(let a=this.particles.length;a<this.particlenum;a++)this.particles.push(new Ball(Math.floor(Math.random()*this.width),Math.floor(Math.random()*this.height)))},canvasRender:function(){this.particles.forEach(a=>a.draw())},update:function(){if(this.particles.forEach(a=>context.clearRect(a.x-(radius+1),a.y-(radius+1),2*radius+2,2*radius+2)),this.particles.forEach(a=>a.update(this.heating)),this.particles.forEach((a,b)=>a.bounce(a,b)),!0==this.track_particle){context2.beginPath(),context2.arc(this.particles[0].x,this.particles[0].y,2,0,2*Math.PI,!1);let a=totalVelocity(this.particles[0].x_speed,this.particles[0].y_speed);context2.fillStyle=colorscale(1>a/8?a/8:1),context2.fill()}},step:function(){this.update(),this.canvasRender()},animate:function(a){let b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(c){window.setTimeout(c,1e3/this.fps)};return b(a)},sortData:function(){}},watch:{particlenum:function(){this.adjustParticles()},width:function(){canvas.width=this.width,canvas.style.width=this.width,canvas2.width=this.width,canvas2.style.width=this.width},height:function(){canvas.height=this.height,canvas.style.height=this.height,canvas2.height=this.height,canvas2.style.height=this.height},track_particle:function(){context2.clearRect(0,0,this.width,this.height)}},mounted:function(){for(let a=0;a<this.particlenum;a++)this.particles.push(new Ball(20*a,20*a));this.canvasRender()}}),step=function(){app.update(),app.canvasRender(),app.animate(step)};window.onload=function(){app.animate(step)};function randNeg(){return 1==Math.floor(2*Math.random())?1:-1}function totalVelocity(a,b){return Math.sqrt(Math.pow(a,2)+Math.pow(b,2))}